#!/bin/bash

set -e

SCRIPT_DIR=$PWD
VIM_DEPENDENCY_DIR="$HOME/.vim/pack/$(whoami)/start/"

echo "Vim dependencies will be cloned in '$VIM_DEPENDENCY_DIR'"
mkdir --parents --verbose $VIM_DEPENDENCY_DIR

DEPS=(
  airblade/vim-gitgutter.git
  altercation/vim-colors-solarized.git
  jiangmiao/auto-pairs.git
  keith/rspec.vim.git
  mileszs/ack.vim.git
  mxw/vim-jsx.git
  pangloss/vim-javascript.git
  scrooloose/nerdtree.git
  sstallion/vim-wildignore.git
  tpope/vim-abolish.git
  tpope/vim-commentary.git
  tpope/vim-endwise.git
  tpope/vim-fugitive.git
  tpope/vim-rails.git
  tpope/vim-surround.git
  vim-ruby/vim-ruby.git
  wincent/command-t.git
  wincent/terminus.git
)

cd $VIM_DEPENDENCY_DIR

for DEP in ${DEPS[@]}; do
  REPO="https://github.com/$DEP"
  echo "Cloning from $REPO..."
  git clone $REPO --verbose
done

echo "Creating symlinks for dotfiles..."
cd $SCRIPT_DIR
DOTFILES=$(git ls-files | grep "^\.")
echo "$DOTFILES" | xargs -t -I % ln -sv "$SCRIPT_DIR/"% "$HOME"

echo "Creating symlink for wildignore"
ln -sv "$SCRIPT_DIR/wildignore" "$HOME/.vim/"

cd "$VIM_DEPENDENCY_DIR/command-t"
rake make
